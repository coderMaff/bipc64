// Bip C64 Edition
// 07/05/21 maf created
// 21/05/21 maf got keyboard code working split to own library file
// to do:
// 		Background, look into charmaps and replacing black background
//		Make sprites move in facing direction
//		Start using speed from throttle
//		Display speed and throttle text
//		movesprites should itterate through memory blocks for each player/bullet/balloon rather than do the lot long handed
// 		Sprites rotate far to slowly

// -[ Constants ]---------------------------------------------------------------

#import "..\libs\constants.asm"

.const MAXTHROTTLE = 5
.const MINTHROTTLE = 1

// Offsets into structure that holds sprite data
.const OFFSET_THROTTLE = 0
.const OFFSET_SPEED = 1
.const OFFSET_FACING = 2
.const OFFSET_SCORE = 3
.const OFFSET_LASTXPOS = 4
.const OFFSET_LASYPOS = 5
.const OFFSET_TYPE = 6
.const OFFSET_FSHOOT = 7

// -[ Begin ]-------------------------------------------------------------------

BasicUpstart2(start)

.pc = $5000 "maincode"

// - import source file_save

.import source "..\libs\input.asm"

.import source "initialise.asm"
.import source "textout.asm"
.import source "handlekeys.asm"
.import source "drawhud.asm"
.import source "movesprites.asm"


// -----------------------------------------------------------------------------

//set screen up
start:
	jsr initialise

mainloop:									// 523e

// Draw once per screen refresh
waitforraster:
	lda $d012								// Grab raster position
	cmp #240								// Check if its finished drawing play area
	bne waitforraster				// It hasnt

	jsr handlekeys					// 5091
	jsr movesprites					// 515a
	jsr drawhud							// 50fa
	jmp mainloop

end:
	rts

// --[ Variables ]--------------------------------------------------------------

welcome_text:
	.encoding "screencode_upper"
	.text "BIP V20210522 BY MATT BUSHELL"
	.byte $ff

throttle_text0:
	.encoding "screencode_upper"
	.text "THROTTLE:----"
	.byte $ff

throttle_text1:
	.encoding "screencode_upper"
	.text "THROTTLE:----"
	.byte $ff

speed_text0:
	.encoding "screencode_upper"
	.text "SPEED:----"
	.byte $ff

speed_text1:
	.encoding "screencode_upper"
	.text "SPEED:----"
	.byte $ff

vPlayer0:
vP0Throttle:													// + 0 OFFSET_THROTTLE
	.byte 0
vP0Speed:															// + 1 OFFSET_SPEED
	.byte 0
vP0Facing:														// + 2 OFFSET_FACING
	.byte 0
vP0Score:															// + 3 OFFSET_SCORE
	.byte 0
vP0LastXPos:													// + 4 OFFSET_LASTXPOS
	.byte 0
	.byte 0
vP0LastYPos:													// + 5 OFFSET_LASYPOS
	.byte 0
vP0Type:															// + 6 OFFSET_TYPE
	.byte 0															// Type 0 Right facing sprite
vP0fShooting:													// + 7 OFFSET_FSHOOT
	.byte 0

vPlayer1:
vP1Throttle:
	.byte 0
vP1Speed:
	.byte 0
vP1Facing:
	.byte 127
vP1Score:
	.byte 0
vP1LastXPos:
	.byte 0
	.byte 1
vP1LastYPos:													// + 5
	.byte 0
vP1Type:
	.byte 1															// Type 1 Left facing sprite
vP1fShooting:
	.byte 0

// sprite 0 Right
*=$0a00 "sprite0_r"
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %01110000,%01111111,%11111000
	.byte %11110000,%00111111,%11110000
	.byte %11110000,%00000000,%00000000
	.byte %11111000,%00000000,%00000000
	.byte %11111111,%11111111,%11111110
	.byte %11111111,%11111111,%11111111
	.byte %01111111,%11111111,%11111111
	.byte %01111111,%11111111,%11111110
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00011000,%00000000
	.byte %00000000,%00111100,%00000000

// Sprite 0 Right up
*=$0a40 "sprite0_ru"
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000110,%00011100
	.byte %00000000,%00001110,%00111110
	.byte %00000000,%00011100,%01111110
	.byte %00000000,%00111000,%11111110
	.byte %00000000,%01110001,%11111100
	.byte %00000000,%11100011,%11111000
	.byte %00000001,%11000111,%11110000
	.byte %00000011,%10001111,%11100000
	.byte %00000000,%00011111,%11000000
	.byte %00000000,%00111111,%10000000
	.byte %00000000,%01111111,%00000000
	.byte %00000000,%11111110,%00000000
	.byte %11110001,%11111100,%00000000
	.byte %11111011,%11111000,%00011100
	.byte %11111111,%11110000,%00011000
	.byte %00111111,%11100000,%00010000
	.byte %00001111,%10000000,%00000000
	.byte %00000010,%00000000,%00000000
	.byte %00000000,%00000000,%00000000

// Sprite 0 Up
*=$0a80 "sprite0_u"
	.byte %00000000,%00000000,%11000000
	.byte %00000000,%00000001,%11100000
	.byte %00000000,%00100001,%11100000
	.byte %00000000,%00110001,%11100000
	.byte %00000000,%00110001,%11100000
	.byte %00000000,%00110001,%11100000
	.byte %00000000,%00110001,%11100000
	.byte %00000000,%00110001,%11100000
	.byte %00000000,%00110001,%11100000
	.byte %00000000,%00110001,%11100001
	.byte %00000000,%00110001,%11100011
	.byte %00000000,%00100001,%11100011
	.byte %00000000,%00000001,%11100001
	.byte %00000000,%00000001,%11100000
	.byte %00000000,%00000001,%11100000
	.byte %00000000,%00000001,%11100000
	.byte %00000000,%00000001,%11100000
	.byte %00000000,%00111111,%11100000
	.byte %00000000,%00111111,%11100000
	.byte %00000000,%00111111,%11100000
	.byte %00000000,%00001111,%10000000

	// Sprite 0 Up Left
*=$0ac0 "sprite0_ul"
	.byte %00011100,%00000000,%00000000
	.byte %00111110,%00000001,%00000000
	.byte %00111111,%00000001,%10000000
	.byte %00111111,%10000001,%11000000
	.byte %00011111,%11000000,%00000000
	.byte %00001111,%11100000,%00000000
	.byte %00000111,%11110000,%00000000
	.byte %00000011,%11111000,%00000000
	.byte %00110001,%11111100,%00000000
	.byte %00111000,%11111110,%00000000
	.byte %00011100,%01111111,%00000000
	.byte %00001110,%00111111,%10000000
	.byte %00000111,%00011111,%11000000
	.byte %00000011,%10001111,%11000000
	.byte %00000001,%11000111,%11100000
	.byte %00000000,%11000011,%11100000
	.byte %00000000,%01000001,%11110000
	.byte %00000000,%00000000,%11100000
	.byte %00000000,%00000001,%11100000
	.byte %00000000,%00000011,%11000000
	.byte %00000000,%00000011,%11000000


// Sprite 0 Left
*=$0b00 "sprite0_l"
	.byte %00000000,%00111100,%00000000
	.byte %00000000,%00011000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %01111111,%11111111,%11111110
	.byte %11111111,%11111111,%11111111
	.byte %11111111,%11111111,%11111111
	.byte %11111111,%11111111,%11111111
	.byte %01111111,%11111111,%11111111
	.byte %00000000,%00000000,%00011111
	.byte %00000000,%00000000,%00001111
	.byte %00001111,%11111100,%00001111
	.byte %00011111,%11111110,%00001110
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000

// Sprite 0 Left Down
*=$0b40 "sprite0_ld"
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%01000000
	.byte %00000000,%00000001,%11110000
	.byte %00001000,%00000111,%11111100
	.byte %00011000,%00001111,%11111111
	.byte %00111000,%00011111,%11011111
	.byte %00000000,%00111111,%10001111
	.byte %00000000,%01111111,%00000000
	.byte %00000000,%11111110,%00000000
	.byte %00000001,%11111100,%00000000
	.byte %00000011,%11111000,%00000000
	.byte %00000111,%11110001,%11000000
	.byte %00001111,%11100011,%10000000
	.byte %00011111,%11000111,%00000000
	.byte %00111111,%10001110,%00000000
	.byte %01111111,%00011100,%00000000
	.byte %01111110,%00111000,%00000000
	.byte %01111100,%01110000,%00000000
	.byte %00111000,%01100000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000

// Sprite 0 Down
*=$0b80 "sprite0_d"
	.byte %00000001,%11110000,%00000000
	.byte %00000111,%11111100,%00000000
	.byte %00000111,%11111100,%00000000
	.byte %00000111,%11111100,%00000000
	.byte %00000111,%10000000,%00000000
	.byte %00000111,%10000000,%00000000
	.byte %00000111,%10000000,%00000000
	.byte %00000111,%10000000,%00000000
	.byte %10000111,%10000000,%00000000
	.byte %11000111,%10000100,%00000000
	.byte %11000111,%10001100,%00000000
	.byte %10000111,%10001100,%00000000
	.byte %00000111,%10001100,%00000000
	.byte %00000111,%10001100,%00000000
	.byte %00000111,%10001100,%00000000
	.byte %00000111,%10001100,%00000000
	.byte %00000111,%10001100,%00000000
	.byte %00000111,%10001100,%00000000
	.byte %00000111,%10000100,%00000000
	.byte %00000111,%10000000,%00000000
	.byte %00000011,%00000000,%00000000

// Sprite 0 Down Right
*=$0bc0 "sprite0_dr"
	.byte %00001110,%00000000,%00000000
	.byte %00001110,%00000000,%00000000
	.byte %00011110,%00000000,%00000000
	.byte %00011110,%00000000,%00000000
	.byte %00111100,%00000000,%00000000
	.byte %00111000,%00000000,%00000000
	.byte %01111100,%00010000,%00000000
	.byte %00111110,%00011000,%00000000
	.byte %00111111,%00011100,%00000000
	.byte %00011111,%10001110,%00000000
	.byte %00011111,%11000111,%00000000
	.byte %00001111,%11100011,%10000000
	.byte %00000111,%11110001,%11000000
	.byte %00000011,%11111000,%11100000
	.byte %00000001,%11111100,%01100000
	.byte %00000000,%11111110,%00000000
	.byte %00000000,%01111111,%00000000
	.byte %00000000,%00111111,%10000000
	.byte %00000000,%00011111,%11000000
	.byte %00011100,%00001111,%11100000
	.byte %00001100,%00000111,%11100000
	.byte %00000100,%00000011,%11100000
	.byte %00000000,%00000001,%11000000
	.byte %00000000,%00000000,%00000000

// sprite 1 / singlecolor / left
*=$0d00 "sprite1_l"
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00011111,%11111110,%00001110
	.byte %00001111,%11111100,%00001111
	.byte %00000000,%00000000,%00001111
	.byte %00000000,%00000000,%00011111
	.byte %01111111,%11111111,%11111111
	.byte %11111111,%11111111,%11111111
	.byte %11111111,%11111111,%11111110
	.byte %01111111,%11111111,%11111110
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00011000,%00000000
	.byte %00000000,%00111100,%00000000

// Sprite 1 left down
*=$0d40 "sprite1_ld"
	.byte %00000000,%00000011,%11000000
	.byte %00000000,%00000011,%11000000
	.byte %00000000,%00000001,%11100000
	.byte %00000000,%00000000,%11100000
	.byte %00000000,%01000001,%11110000
	.byte %00000000,%11000011,%11100000
	.byte %00000001,%11000111,%11100000
	.byte %00000011,%10001111,%11000000
	.byte %00000111,%00011111,%11000000
	.byte %00001110,%00111111,%10000000
	.byte %00011100,%01111111,%00000000
	.byte %00111000,%11111110,%00000000
	.byte %00110001,%11111100,%00000000
	.byte %00000011,%11111000,%00000000
	.byte %00000111,%11110000,%00000000
	.byte %00001111,%11100000,%00000000
	.byte %00011111,%11000000,%00000000
	.byte %00111111,%10000001,%11000000
	.byte %00111111,%00000001,%10000000
	.byte %00111110,%00000001,%00000000
	.byte %00011100,%00000000,%00000000

// Sprite 1 down
*=$0d80 "sprite1_d"
	.byte %00000000,%00001111,%10000000
	.byte %00000000,%00111111,%11100000
	.byte %00000000,%00111111,%11100000
	.byte %00000000,%00111111,%11100000
	.byte %00000000,%00000001,%11100000
	.byte %00000000,%00000001,%11100000
	.byte %00000000,%00000001,%11100000
	.byte %00000000,%00000001,%11100000
	.byte %00000000,%00000001,%11100001
	.byte %00000000,%00100001,%11100011
	.byte %00000000,%00110001,%11100011
	.byte %00000000,%00110001,%11100001
	.byte %00000000,%00110001,%11100000
	.byte %00000000,%00110001,%11100000
	.byte %00000000,%00110001,%11100000
	.byte %00000000,%00110001,%11100000
	.byte %00000000,%00110001,%11100000
	.byte %00000000,%00110001,%11100000
	.byte %00000000,%00100001,%11100000
	.byte %00000000,%00000001,%11100000
	.byte %00000000,%00000000,%11000000

	// Sprite 1 down right
*=$0dc0 "sprite1_dr"
	.byte %00000000,%00000000,%00000000
	.byte %00000010,%00000000,%00000000
	.byte %00001111,%10000000,%00000000
	.byte %00111111,%11100000,%00010000
	.byte %11111111,%11110000,%00011000
	.byte %11111011,%11111000,%00011100
	.byte %11110001,%11111100,%00000000
	.byte %00000000,%11111110,%00000000
	.byte %00000000,%01111111,%00000000
	.byte %00000000,%00111111,%10000000
	.byte %00000000,%00011111,%11000000
	.byte %00000011,%10001111,%11100000
	.byte %00000001,%11000111,%11110000
	.byte %00000000,%11100011,%11111000
	.byte %00000000,%01110001,%11111100
	.byte %00000000,%00111000,%11111110
	.byte %00000000,%00011100,%01111110
	.byte %00000000,%00001110,%00111110
	.byte %00000000,%00000110,%00011100
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000

// Sprite 1 Right
*=$0e00 "sprite1_r"
	.byte %00000000,%00111100,%00000000
	.byte %00000000,%00011000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %01111111,%11111111,%11111110
	.byte %11111111,%11111111,%11111111
	.byte %11111111,%11111111,%11111111
	.byte %11111111,%11111111,%11111111
	.byte %11111111,%11111111,%11111110
	.byte %11111000,%00000000,%00000000
	.byte %11110000,%00000000,%00000000
	.byte %11110000,%00111111,%11110000
	.byte %01110000,%01111111,%11111000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000

// Sprite 1 Right up
*=$0e40 "sprite1_ru"
	.byte %00000000,%00000001,%11000000
	.byte %00000100,%00000011,%11100000
	.byte %00001100,%00000111,%11100000
	.byte %00011100,%00001111,%11100000
	.byte %00000000,%00011111,%11000000
	.byte %00000000,%00111111,%10000000
	.byte %00000000,%01111111,%00000000
	.byte %00000000,%11111110,%00000000
	.byte %00000001,%11111100,%01100000
	.byte %00000011,%11111000,%11100000
	.byte %00000111,%11110001,%11000000
	.byte %00001111,%11100011,%10000000
	.byte %00011111,%11000111,%00000000
	.byte %00011111,%10001110,%00000000
	.byte %00111111,%00011100,%00000000
	.byte %00111110,%00011000,%00000000
	.byte %01111100,%00010000,%00000000
	.byte %00111000,%00000000,%00000000
	.byte %00111100,%00000000,%00000000
	.byte %00011110,%00000000,%00000000
	.byte %00011110,%00000000,%00000000

// Sprite 1 up
*=$0e80 "sprite1_u"
	.byte %00000011,%00000000,%00000000
	.byte %00000111,%10000000,%00000000
	.byte %00000111,%10000100,%00000000
	.byte %00000111,%10001100,%00000000
	.byte %00000111,%10001100,%00000000
	.byte %00000111,%10001100,%00000000
	.byte %00000111,%10001100,%00000000
	.byte %00000111,%10001100,%00000000
	.byte %00000111,%10001100,%00000000
	.byte %10000111,%10001100,%00000000
	.byte %11000111,%10001100,%00000000
	.byte %11000111,%10000100,%00000000
	.byte %10000111,%10000000,%00000000
	.byte %00000111,%10000000,%00000000
	.byte %00000111,%10000000,%00000000
	.byte %00000111,%10000000,%00000000
	.byte %00000111,%10000000,%00000000
	.byte %00000111,%11111100,%00000000
	.byte %00000111,%11111100,%00000000
	.byte %00000111,%11111100,%00000000
	.byte %00000001,%11110000,%00000000

// Sprite 1 up left
*=$0ec0 "sprite1_ul"
	.byte %00000000,%00000000,%00000000
	.byte %00000000,%00000000,%00000000
	.byte %00111000,%01100000,%00000000
	.byte %01111100,%01110000,%00000000
	.byte %01111110,%00111000,%00000000
	.byte %01111111,%00011100,%00000000
	.byte %00111111,%10001110,%00000000
	.byte %00011111,%11000111,%00000000
	.byte %00001111,%11100011,%10000000
	.byte %00000111,%11110001,%11000000
	.byte %00000011,%11111000,%00000000
	.byte %00000001,%11111100,%00000000
	.byte %00000000,%11111110,%00000000
	.byte %00000000,%01111111,%00000000
	.byte %00000000,%00111111,%10001111
	.byte %00111000,%00011111,%11011111
	.byte %00011000,%00001111,%11111111
	.byte %00001000,%00000111,%11111100
	.byte %00000000,%00000001,%11110000
	.byte %00000000,%00000000,%01000000
	.byte %00000000,%00000000,%00000000
